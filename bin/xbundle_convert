#!/usr/bin/env python

"""xbundle_convert

Description:
    Convert between OLX and xbundle XML formats.
    If the input format in an XML file, the output will be OLX.
    If the input format is a directory, the output will be xbundle.

Usage:
    xbundle_convert convert [--force-studio] <input> <output>
    xbundle_convert test
    xbundle_convert --help
    xbundle_convert -h

Options:
    --force-studio  Forces <sequential> to be followed by <vertical> in export
"""

# PyPi
from docopt import docopt

# local
from xbundle import XBundle, run_tests

# pylint: disable=star-args

def main():
    """
    Convert between OLX and xbundle XML formats.
    """

    # This parses the docstring above and derives all arguments.
    # If the required arguments are missing, it prints basic usage
    # and exits automatically.
    # If required arguments are satisfied, it returns a dict.
    args = docopt(__doc__)

    options = dict(keep_urls=True)
    if args['--force-studio']:
        options['force_studio_format'] = True

    if args['test']:
        run_tests()
        return

    bundle = XBundle(**options)
    infn = args['<input>']
    outfn = args['<output>']
    if infn.endswith('.xml'):
        print "Converting xbundle file '%s' to edX xml directory '%s'" % (infn, outfn)
        bundle.load(infn)
        bundle.export_to_directory(outfn)
        print "done"
    elif outfn.endswith('.xml'):
        print "Converting edX xml directory '%s' to xbundle file '%s'" % (infn, outfn)
        bundle.import_from_directory(infn)
        bundle.save(outfn)
        print "done"
    else:
        print "Invalid input; run with --help for more info."

if __name__ == '__main__':
    main()
